<aside
  *transloco="let t"
  role="navigation"
  [attr.aria-label]="t('nav.mainNavigation')"
  [attr.aria-expanded]="!layout.sidebarCollapsed()"
  class="fixed start-[16px] top-[16px] h-[calc(100vh-32px)] z-[1000]
         rounded-xl border border-surface-200 dark:border-surface-200
         bg-surface-0/95 dark:bg-surface-50/95 backdrop-blur-md
         shadow-[0_4px_24px_rgba(0,0,0,0.06)]
         transition-[width] duration-300 ease-[cubic-bezier(0.4,0,0.2,1)]
         flex flex-col overflow-hidden"
  [style.width]="layout.sidebarWidth()"
>
  <!-- Logo / Brand -->
  <div class="shrink-0 flex items-center px-4 h-16 border-b border-surface-200 dark:border-surface-200">
    @if (!layout.sidebarCollapsed()) {
      <span class="text-lg font-bold text-primary whitespace-nowrap">{{ t('app.name') }}</span>
    } @else {
      <span class="mx-auto text-lg font-bold text-primary">E</span>
    }
  </div>

  <!-- Navigation Items -->
  <nav class="flex-1 overflow-y-auto overflow-x-hidden sidebar-scroll p-2 flex flex-col gap-1">
    @for (item of menuItems; track item.route) {
      <a
        [routerLink]="item.route"
        routerLinkActive="bg-primary/10 !text-primary font-semibold"
        [routerLinkActiveOptions]="{ exact: item.exact }"
        [pTooltip]="layout.sidebarCollapsed() ? t(item.labelKey) : ''"
        tooltipPosition="right"
        class="flex items-center gap-3 px-3 py-2.5 rounded-lg min-h-11
               text-surface-500 dark:text-surface-600
               hover:text-surface-900 dark:hover:text-surface-900
               hover:bg-surface-100 dark:hover:bg-surface-100/10
               transition-colors duration-200 no-underline"
        [class.justify-center]="layout.sidebarCollapsed()"
      >
        <i [class]="item.icon + ' text-xl shrink-0'" style="width: 20px; text-align: center;"></i>
        @if (!layout.sidebarCollapsed()) {
          <span class="whitespace-nowrap overflow-hidden">{{ t(item.labelKey) }}</span>
        }
      </a>
    }
  </nav>

  <!-- Bottom Section -->
  <div class="shrink-0 border-t border-surface-200 dark:border-surface-200 p-3 flex flex-col gap-2">
    <!-- Theme + Language controls -->
    <div class="flex items-center" [class.justify-center]="layout.sidebarCollapsed()" [class.gap-2]="!layout.sidebarCollapsed()">
      <theme-toggle />
      @if (!layout.sidebarCollapsed()) {
        <language-selector />
      }
    </div>

    <!-- User profile -->
    @if (user(); as u) {
      <div class="flex items-center gap-3 px-2 py-2 rounded-lg">
        <div class="size-9 rounded-full bg-primary text-primary-contrast flex items-center justify-center text-sm font-semibold shrink-0">
          {{ u.name.charAt(0).toUpperCase() }}
        </div>
        @if (!layout.sidebarCollapsed()) {
          <div class="overflow-hidden">
            <div class="text-sm font-medium text-surface-900 dark:text-surface-900 truncate">{{ u.name }}</div>
            <div class="text-xs text-surface-500 dark:text-surface-600 truncate">{{ u.email }}</div>
          </div>
        }
      </div>
    }
  </div>
</aside>
